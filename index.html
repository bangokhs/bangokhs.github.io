<script>
    // JavaScript: ìŠ¬ë¡¯ë¨¸ì‹  ë¡œì§ (í™•ë¥  ë° ì½”ì¸ ëª¨ë¸ ì ìš©)
    
    // --- 1. ì„¤ì • ë° ë³€ìˆ˜ ---
    
    // ì‹¬ë³¼ê³¼ í™•ë¥  (ì´ í™•ë¥  í•©ê³„ëŠ” 100%ê°€ ë˜ë„ë¡ ì¡°ì •)
    const probabilities = [
        { symbol: 'ğŸ’', weight: 40 }, 
        { symbol: 'ğŸ‹', weight: 30 },
        { symbol: 'ğŸ””', weight: 20 },
        { symbol: 'â­', weight: 7 }, 
        { symbol: '7ï¸âƒ£', weight: 3 }  
    ];
    
    // ì­íŒŸ ë°°ìœ¨ (ë°°íŒ… ê¸ˆì•¡ ëŒ€ë¹„)
    const payouts = {
        'ğŸ’': 10,
        'ğŸ‹': 20,
        'ğŸ””': 50,
        'â­': 100,
        '7ï¸âƒ£': 500
    };
    
    const partialMatchPayout = 3; // ë‘ ê°œ ì¼ì¹˜ ë³´ë„ˆìŠ¤ (3ë°°)

    // ê²Œì„ ë³€ìˆ˜
    let coinBalance = 100;
    const betAmount = 10;
    // ë¦´ ë©ˆì¶¤ ê°„ê²©ì„ 1000ms (1ì´ˆ)ë¡œ ì •ì˜í•©ë‹ˆë‹¤.
    const REEL_STOP_INTERVAL = 1000; 
    const SPIN_DURATION = 3000; // ê° ë¦´ì˜ ì´ íšŒì „ ì‹œê°„ (3ì´ˆë¡œ ëŠ˜ë ¤ ì‹œì°¨ë¥¼ ëª…í™•íˆ í•¨)

    // DOM ìš”ì†Œ
    const reelElements = [
        document.getElementById('reel1'),
        document.getElementById('reel2'),
        document.getElementById('reel3')
    ];
    const spinButton = document.getElementById('spinButton');
    const resultDisplay = document.getElementById('result');
    const balanceDisplay = document.getElementById('coinBalanceDisplay');

    // ì”ì•¡ í‘œì‹œ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
    function updateBalanceDisplay() {
        balanceDisplay.textContent = coinBalance;
    }

    // --- 2. í™•ë¥  ê¸°ë°˜ ì‹¬ë³¼ ì„ íƒ ë¡œì§ ---
    
    function getSymbolByProbability() {
        const totalWeight = probabilities.reduce((sum, item) => sum + item.weight, 0);
        let random = Math.random() * totalWeight;

        for (const item of probabilities) {
            if (random < item.weight) {
                return item.symbol;
            }
            random -= item.weight;
        }
    }
    
    // --- 3. ë¦´ íšŒì „ ëª¨ì…˜ ë¡œì§ ---
    
    function startSpinMotion(reelElement, spinDuration) {
        const allSymbols = probabilities.map(p => p.symbol);
        let startTime = null;

        function animate(timestamp) {
            if (!startTime) startTime = timestamp;
            const elapsed = timestamp - startTime;
            
            if (elapsed < spinDuration) {
                const randomIndex = Math.floor(Math.random() * allSymbols.length);
                reelElement.textContent = allSymbols[randomIndex];
                requestAnimationFrame(animate);
            }
        }
        requestAnimationFrame(animate);
    }

    // --- 4. ê²Œì„ ë¡œì§ (ìˆ˜ì •ëœ ë¶€ë¶„) ---

    // ë¦´ì„ ëŒë¦¬ê³  ìµœì¢… ì‹¬ë³¼ì„ í™•ì •í•˜ëŠ” í•¨ìˆ˜
    function spinReelAndGetResult(reelElement, finalSymbol, spinDuration) {
        return new Promise(resolve => {
            // íšŒì „ ëª¨ì…˜ ì‹œì‘ (ë°”ë¡œ ì‹œì‘)
            startSpinMotion(reelElement, spinDuration);
            
            // ì§€ì •ëœ íšŒì „ ì‹œê°„ í›„ ë©ˆì¶¤
            setTimeout(() => {
                reelElement.textContent = finalSymbol; // ìµœì¢… ì‹¬ë³¼ í‘œì‹œ
                resolve(finalSymbol);
            }, spinDuration);
        });
    }

    // ì „ì²´ ìŠ¬ë¡¯ë¨¸ì‹ ì„ ì‘ë™ì‹œí‚¤ëŠ” í•¨ìˆ˜
    async function spinSlots() {
        if (coinBalance < betAmount) {
            resultDisplay.textContent = "ì½”ì¸ì´ ë¶€ì¡±í•©ë‹ˆë‹¤! (ì´ˆê¸°í™”í•˜ë ¤ë©´ ìƒˆë¡œê³ ì¹¨)";
            return;
        }

        coinBalance -= betAmount;
        updateBalanceDisplay();
        spinButton.disabled = true;
        resultDisplay.textContent = "ë¦´ì´ ëŒì•„ê°‘ë‹ˆë‹¤... í–‰ìš´ì„ ë¹Œì–´ìš”!";
        resultDisplay.style.color = '#333';
        
        const finalSymbols = reelElements.map(() => getSymbolByProbability()); // ì„¸ ë¦´ì˜ ìµœì¢… ê²°ê³¼ë¥¼ ë¯¸ë¦¬ ê²°ì •
        const results = [];
        
        // ë¦´ 1, 2, 3ì´ 1ì´ˆ ê°„ê²©ìœ¼ë¡œ ë©ˆì¶”ë„ë¡ ì„¤ì •
        for (let i = 0; i < reelElements.length; i++) {
            // ê° ë¦´ì˜ ì´ íšŒì „ ì‹œê°„ = ê¸°ë³¸ íšŒì „ ì‹œê°„ + (ë¦´ ë²ˆí˜¸ * ê°„ê²©)
            const duration = SPIN_DURATION + (i * REEL_STOP_INTERVAL);
            
            // ë¦´ íšŒì „ ì‹œì‘ (await ì—†ì´ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì‹œì‘)
            const spinPromise = spinReelAndGetResult(reelElements[i], finalSymbols[i], duration)
                .then(symbol => {
                    results.push(symbol);
                });
                
            // ëª¨ë“  ë¦´ì´ ëŒê¸° ì‹œì‘í•œ í›„, ë§ˆì§€ë§‰ ë¦´ì˜ ë©ˆì¶¤ì„ ê¸°ë‹¤ë¦¼
            if (i === reelElements.length - 1) {
                await spinPromise; // ë§ˆì§€ë§‰ ë¦´ì´ ë©ˆì¶œ ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¼
            }
        }
        
        // ê²°ê³¼ í™•ì¸
        checkResult(results);
        
        spinButton.disabled = false;
    }

    // ìŠ¹ë¦¬ ì¡°ê±´ì„ í™•ì¸í•˜ê³  ì½”ì¸ì„ ì§€ê¸‰í•˜ëŠ” í•¨ìˆ˜
    function checkResult(results) {
        // ê²°ê³¼ ë°°ì—´ì´ 3ê°œê°€ ì•„ë‹ ê²½ìš°ë¥¼ ëŒ€ë¹„í•´ ê²€ì‚¬
        if (results.length !== 3) {
            resultDisplay.textContent = "ì˜¤ë¥˜: ë¦´ ê²°ê³¼ê°€ ë¶ˆì™„ì „í•©ë‹ˆë‹¤.";
            resultDisplay.style.color = 'red';
            return;
        }

        const [r1, r2, r3] = results;
        let message = "";
        let winAmount = 0;

        if (r1 === r2 && r2 === r3) {
            const multiplier = payouts[r1];
            winAmount = betAmount * multiplier;
            coinBalance += winAmount;
            
            message = `ğŸ‰ ğŸ’¥ğŸ’¥ JACKPOT! ğŸ’¥ğŸ’¥ ${r1} 3ê°œ ì¼ì¹˜! ${multiplier}ë°° íšë“! (+${winAmount})`;
            resultDisplay.style.color = '#ff9800'; 
        } else if (r1 === r2 || r2 === r3 || r1 === r3) {
            winAmount = betAmount * partialMatchPayout;
            coinBalance += winAmount;

            message = `ğŸ¥³ ë‘ ê°œ ì¼ì¹˜! ë³´ë„ˆìŠ¤ ${partialMatchPayout}ë°° íšë“! (+${winAmount})`;
            resultDisplay.style.color = '#4CAF50'; 
        } else {
            message = `ğŸ˜­ ì•„ì‰½ë„¤ìš”. ë‹¤ì‹œ ë„ì „! (-${betAmount})`;
            resultDisplay.style.color = '#d32f2f'; 
        }
        
        resultDisplay.textContent = message;
        updateBalanceDisplay();
    }

    // ì´ˆê¸°í™”
    updateBalanceDisplay();
    spinButton.addEventListener('click', spinSlots);
    
</script>
