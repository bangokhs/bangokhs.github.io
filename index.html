<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í™•ë¥  ê¸°ë°˜ ìŠ¬ë¡¯ë¨¸ì‹  (í™•ì¥íŒ)</title>
    <style>
        /* CSS: ì‹¤ì œ ìŠ¬ë¡¯ë¨¸ì‹  í…Œë§ˆ ë””ìì¸ ì ìš© ë° ë ˆì´ì•„ì›ƒ ìˆ˜ì • */
        body {
            font-family: 'Malgun Gothic', 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            background-color: #ffffff; /* ë°°ê²½ìƒ‰ í°ìƒ‰ */
            padding: 20px;
        }
        
        .top-utility { /* ì¢Œì¸¡ ìƒë‹¨ ì½”ì¸ íšë“ ë²„íŠ¼ê³¼ ìš°ì¸¡ ìƒë‹¨ í™•ë¥ í‘œë¥¼ ìœ„í•œ ì»¨í…Œì´ë„ˆ */
            width: 100%;
            max-width: 900px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            position: absolute; /* ì ˆëŒ€ ìœ„ì¹˜ë¡œ ìƒë‹¨ ë°°ì¹˜ */
            top: 20px;
        }
        
        #earnCoinButton {
            padding: 10px 15px;
            font-size: 16px;
            background-color: #4CAF50; /* ì´ˆë¡ìƒ‰ ë²„íŠ¼ */
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            box-shadow: 0 4px #388E3C;
            z-index: 10; /* ë‹¤ë¥¸ ìš”ì†Œ ìœ„ì— í‘œì‹œë˜ë„ë¡ ì„¤ì • */
        }
        
        #earnCoinButton:active {
            box-shadow: 0 2px #388E3C;
            transform: translateY(2px);
        }
        
        #probability-table {
            background-color: #f8f8f8;
            border: 2px solid #ddd;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            font-size: 14px;
            z-index: 10; /* ë‹¤ë¥¸ ìš”ì†Œ ìœ„ì— í‘œì‹œë˜ë„ë¡ ì„¤ì • */
        }
        #probability-table h2 {
            margin-top: 0;
            font-size: 16px;
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
            text-align: center;
        }
        #probability-table table {
            width: 100%;
            border-collapse: collapse;
        }
        #probability-table td {
            padding: 3px 8px;
            text-align: center;
            border-bottom: 1px dotted #eee;
        }
        #probability-table tr:last-child td {
            border-bottom: none;
        }
        
        /* ìŠ¬ë¡¯ë¨¸ì‹  ë³¸ì²´ ë””ìì¸ */
        .game-frame { 
            padding: 30px;
            background-color: #8B0000; 
            border: 10px solid #FFD700; 
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 400px;
            margin-top: 100px; /* ìƒë‹¨ ë²„íŠ¼ê³¼ì˜ ê³µê°„ í™•ë³´ */
        }
        h1 {
            color: #FFD700;
            text-shadow: 2px 2px 4px #000;
        }
        .balance-box {
            margin-bottom: 20px;
            font-size: 20px;
            font-weight: bold;
            color: #000;
            padding: 10px 20px;
            border: 3px solid #000;
            border-radius: 5px;
            background-color: #7CFC00;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
            min-width: 300px;
            text-align: center;
        }
        .slot-container {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }
        .reel { 
            font-size: 60px; 
            width: 100px;
            height: 100px;
            line-height: 100px;
            text-align: center;
            border: 6px solid #C0C0C0; 
            border-radius: 10px;
            background-color: #333; 
            color: #fff; 
            box-shadow: inset 0 0 10px rgba(0,0,0,0.8), 0 5px 10px rgba(0,0,0,0.5);
            overflow: hidden;
        }
        button#spinButton { 
            padding: 15px 50px;
            font-size: 28px;
            cursor: pointer;
            background-color: #FF0000; 
            color: white;
            border: 5px solid #FFD700; 
            border-radius: 50px;
            transition: background-color 0.3s;
            font-weight: bold;
            text-shadow: 1px 1px 2px #000;
        }
        button#spinButton:hover:not(:disabled) {
            background-color: #cc0000;
            box-shadow: 0 0 20px #FFD700;
        }
        button#spinButton:disabled {
            background-color: #ffcdd2;
            cursor: not-allowed;
            border: 5px solid #aaa;
        }
        #result {
            margin-top: 30px;
            font-size: 32px;
            font-weight: 900;
            min-height: 30px;
            color: #FFD700; 
            text-shadow: 1px 1px 2px #000;
        }
    </style>
</head>
<body>
    
    <div class="top-utility">
        <button id="earnCoinButton">ğŸª™ ì½”ì¸ íšë“ (+10)</button>
        
        <div id="probability-table">
            <h2>ì‹¬ë³¼ ë° ë°°ìœ¨</h2>
            <table>
                <thead>
                    <tr><td>ì‹¬ë³¼</td><td>í™•ë¥ (%)</td><td>ë°°ìœ¨(X)</td></tr>
                </thead>
                <tbody id="payoutTableBody">
                </tbody>
            </table>
        </div>
    </div>
    
    <div class="game-frame"> 
        <h1>ìŠ¬ë¡¯ë¨¸ì‹ </h1>
        
        <div class="balance-box">
            ì”ì•¡: <span id="coinBalanceDisplay">100</span> ì½”ì¸ (ë°°íŒ…: 10 ì½”ì¸)
        </div>

        <div class="slot-container">
            <div class="reel" id="reel1">â“</div>
            <div class="reel" id="reel2">â“</div>
            <div class="reel" id="reel3">â“</div>
        </div>

        <button id="spinButton">SPIN</button>

        <div id="result">SPIN ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”!</div>
    </div> 

    <script>
        // JavaScript: ìŠ¬ë¡¯ë¨¸ì‹  ë¡œì§ (ë²„ê·¸ ìˆ˜ì • ë° ì•ˆì •í™” ë²„ì „)
        
        // --- 1. ì„¤ì • ë° ë³€ìˆ˜ ---
        const probabilities = [
            { symbol: 'ğŸ’', weight: 35, payout: 2 }, 
            { symbol: 'ğŸŒ¶', weight: 25, payout: 2 }, // âš ï¸ ì›ë³¸ ì½”ë“œì˜ ë¬¸ë²• ì˜¤ë¥˜ ìˆ˜ì •: ì‰¼í‘œ ì¶”ê°€
            { symbol: 'ğŸ‹', weight: 20, payout: 5 },
            { symbol: 'ğŸ””', weight: 10, payout: 20 },
            { symbol: 'â­', weight: 7, payout: 100 }, 
            { symbol: '7ï¸âƒ£', weight: 3, payout: 10000 }  
        ];
        
        const partialMatchPayout = 3; 
        const INITIAL_BALANCE = 100; 
        const EARN_AMOUNT = 10; // ì½”ì¸ íšë“ ë²„íŠ¼ìœ¼ë¡œ ì–»ì„ ê¸ˆì•¡
        
        let coinBalance; 
        const betAmount = 10;
        const REEL_STOP_INTERVAL = 500; 
        const SPIN_DURATION = 1500; 
        const STORAGE_KEY = 'slotMachineCoinBalance'; 

        const reelElements = [
            document.getElementById('reel1'),
            document.getElementById('reel2'),
            document.getElementById('reel3')
        ];
        const spinButton = document.getElementById('spinButton');
        const earnCoinButton = document.getElementById('earnCoinButton');
        const resultDisplay = document.getElementById('result');
        const balanceDisplay = document.getElementById('coinBalanceDisplay');
        const payoutTableBody = document.getElementById('payoutTableBody');

        // --- 2. ë¡œì»¬ ì €ì¥ì†Œ ë° ì”ì•¡ ê´€ë¦¬ ---

        function saveBalance() {
            // ì €ì¥ ì‹œ ê°’ì´ ìˆ«ìì¸ì§€ í™•ì¸í•˜ëŠ” ì•ˆì „ì¥ì¹˜ ì¶”ê°€
            if (!isNaN(coinBalance)) {
                localStorage.setItem(STORAGE_KEY, coinBalance.toString());
            }
        }

        function loadBalance() {
            const savedBalance = localStorage.getItem(STORAGE_KEY);
            // ì €ì¥ëœ ê°’ì´ ìœ íš¨í•˜ì§€ ì•Šê±°ë‚˜ 0ë³´ë‹¤ ì‘ìœ¼ë©´ ì´ˆê¸°ê°’ìœ¼ë¡œ ì„¤ì •
            if (savedBalance === null || isNaN(parseInt(savedBalance)) || parseInt(savedBalance) < 0) {
                coinBalance = INITIAL_BALANCE;
            } else {
                coinBalance = parseInt(savedBalance);
            }
            updateBalanceDisplay();
        }

        function updateBalanceDisplay() {
            balanceDisplay.textContent = coinBalance;
            saveBalance(); 

            if (coinBalance < betAmount) {
                spinButton.disabled = true;
                resultDisplay.textContent = "ì½”ì¸ ë¶€ì¡±! ì½”ì¸ íšë“ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.";
                resultDisplay.style.color = 'red';
            } else {
                spinButton.disabled = false;
            }
        }

        // --- 3. ìœ í‹¸ë¦¬í‹° ê¸°ëŠ¥ ---

        // í™•ë¥  í…Œì´ë¸” ì±„ìš°ê¸°
        function populatePayoutTable() {
            payoutTableBody.innerHTML = ''; // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”
            probabilities.forEach(item => {
                const row = payoutTableBody.insertRow();
                row.insertCell().textContent = item.symbol;
                row.insertCell().textContent = `${(item.weight / 100 * 3).toFixed(2)}%`; // 3ë²ˆì˜ ê¸°íšŒì´ë¯€ë¡œ 3ìœ¼ë¡œ ë‚˜ëˆ„ì–´ì£¼ëŠ” ê²ƒì´ ì¼ë°˜ì ì´ë‚˜, ì—¬ê¸°ì„œëŠ” ì‹¬ë³¼ 1ê°œ í™•ë¥  ê·¸ëŒ€ë¡œ í‘œì‹œ
                row.insertCell().textContent = `${item.payout}X`;
            });
            // ë‘ ê°œ ì¼ì¹˜ ë³´ë„ˆìŠ¤ í–‰ ì¶”ê°€
            const bonusRow = payoutTableBody.insertRow();
            bonusRow.insertCell().textContent = '2ê°œ ì¼ì¹˜';
            bonusRow.insertCell().textContent = '-';
            bonusRow.insertCell().textContent = `ğŸ’/ğŸŒ¶/ğŸ‹: ${betAmount} ë°˜í™˜, ë‚˜ë¨¸ì§€: ${partialMatchPayout}X`;
            bonusRow.style.fontWeight = 'bold';
            bonusRow.cells[2].style.textAlign = 'left'; // í…ìŠ¤íŠ¸ê°€ ê¸¸ì–´ì„œ ì™¼ìª½ ì •ë ¬
        }

        // ì½”ì¸ íšë“ ê¸°ëŠ¥
        function earnCoin() {
            coinBalance += EARN_AMOUNT;
            updateBalanceDisplay();
            resultDisplay.textContent = `ğŸª™ ${EARN_AMOUNT} ì½”ì¸ íšë“! ì”ì•¡: ${coinBalance}`;
            resultDisplay.style.color = '#4CAF50'; 
        }

        // --- 4. í™•ë¥  ê¸°ë°˜ ì‹¬ë³¼ ì„ íƒ ë¡œì§ ---
        
        function getSymbolByProbability() {
            const totalWeight = probabilities.reduce((sum, item) => sum + item.weight, 0);
            let random = Math.random() * totalWeight;

            for (const item of probabilities) {
                if (random < item.weight) {
                    return item.symbol;
                }
                random -= item.weight;
            }
            // ì•ˆì „ì¥ì¹˜
            return probabilities[probabilities.length - 1].symbol; 
        }
        
        // --- 5. ë¦´ íšŒì „ ëª¨ì…˜ ë¡œì§ ---
        
        function startSpinMotion(reelElement, spinDuration) {
            const allSymbols = probabilities.map(p => p.symbol);
            let startTime = null;

            function animate(timestamp) {
                if (!startTime) startTime = timestamp;
                const elapsed = timestamp - startTime;
                
                if (elapsed < spinDuration) {
                    const randomIndex = Math.floor(Math.random() * allSymbols.length);
                    reelElement.textContent = allSymbols[randomIndex];
                    requestAnimationFrame(animate);
                }
            }
            requestAnimationFrame(animate);
        }

        // --- 6. ê²Œì„ ë¡œì§ ---

        function spinReelAndGetResult(reelElement, finalSymbol, spinDuration) {
            return new Promise(resolve => {
                startSpinMotion(reelElement, spinDuration);
                
                setTimeout(() => {
                    reelElement.textContent = finalSymbol;
                    resolve(finalSymbol);
                }, spinDuration);
            });
        }

        async function spinSlots() {
            if (spinButton.disabled) return;

            coinBalance -= betAmount;
            updateBalanceDisplay();
            spinButton.disabled = true;
            resultDisplay.textContent = "ë¦´ì´ ëŒì•„ê°‘ë‹ˆë‹¤... í–‰ìš´ì„ ë¹Œì–´ìš”!";
            resultDisplay.style.color = '#333';
            
            const finalSymbols = reelElements.map(() => getSymbolByProbability()); 
            const spinPromises = [];
            
            for (let i = 0; i < reelElements.length; i++) {
                const duration = SPIN_DURATION + (i * REEL_STOP_INTERVAL);
                
                spinPromises.push(
                    spinReelAndGetResult(reelElements[i], finalSymbols[i], duration)
                );
            }
            
            const results = await Promise.all(spinPromises);

            checkResult(results);
            // ë¦´ íšŒì „ì´ ëë‚œ í›„ ë²„íŠ¼ í™œì„±í™”
            spinButton.disabled = false;
            updateBalanceDisplay();
        }

        function checkResult(results) {
            if (results.length !== 3) {
                resultDisplay.textContent = "ì¹˜ëª…ì ì¸ ì˜¤ë¥˜ ë°œìƒ: ê²°ê³¼ ê°œìˆ˜ ë¶ˆì¼ì¹˜.";
                resultDisplay.style.color = 'red';
                return;
            }

            const [r1, r2, r3] = results;
            let message = "";
            let winAmount = 0;

            // ë¦´ ì‹¬ë³¼ì´ ë‚˜ì˜¤ëŠ” íšŸìˆ˜ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.
            const symbolCounts = {};
            results.forEach(symbol => {
                symbolCounts[symbol] = (symbolCounts[symbol] || 0) + 1;
            });

            // ì­íŒŸ (3ê°œ ì¼ì¹˜) ë¡œì§
            if (r1 === r2 && r2 === r3) {
                // ì¼ì¹˜í•˜ëŠ” ì‹¬ë³¼ ë°ì´í„°ë¥¼ ì°¾ìŠµë‹ˆë‹¤.
                const matchedSymbolData = probabilities.find(p => p.symbol === r1); 
                const multiplier = matchedSymbolData ? matchedSymbolData.payout : 0;
                
                winAmount = betAmount * multiplier;
                coinBalance += winAmount;
                
                message = `ğŸ‰ ğŸ’¥ğŸ’¥ JACKPOT! ğŸ’¥ğŸ’¥ ${r1} 3ê°œ ì¼ì¹˜! ${multiplier}ë°° íšë“! (+${winAmount})`;
                resultDisplay.style.color = '#ff9800'; 
            
            // 2ê°œ ì¼ì¹˜ (ì½”ì¸ ë°˜í™˜ ë° ë³´ë„ˆìŠ¤ ì§€ê¸‰)
            } else if (Object.values(symbolCounts).includes(2)) { // 2ê°œê°€ ì¼ì¹˜í•œ ê²½ìš°ê°€ ìˆë‹¤ë©´
                
                const matchedSymbol = Object.keys(symbolCounts).find(key => symbolCounts[key] === 2);
                
                // ğŸ’ ë˜ëŠ” ğŸŒ¶ ë˜ëŠ” ğŸ‹ 2ê°œ ì¼ì¹˜: ë°°íŒ… ê¸ˆì•¡ë§Œ ë°˜í™˜
                if (['ğŸ’', 'ğŸŒ¶', 'ğŸ‹'].includes(matchedSymbol)) {
                    winAmount = betAmount; 
                    coinBalance += winAmount; 
                    
                    message = `ğŸ¥³ ${matchedSymbol} 2ê°œ ì¼ì¹˜! ë°°íŒ… ê¸ˆì•¡ (${betAmount} ì½”ì¸) ë°˜í™˜!`;
                    resultDisplay.style.color = '#4CAF50'; 
                
                } else {
                    // ë‚˜ë¨¸ì§€ ì‹¬ë³¼ (ğŸ””, â­, 7ï¸âƒ£) 2ê°œ ì¼ì¹˜: ê¸°ì¡´ ë³´ë„ˆìŠ¤ ë°°ìœ¨ ì ìš©
                    winAmount = betAmount * partialMatchPayout;
                    coinBalance += winAmount;

                    message = `ğŸ¥³ ${matchedSymbol} 2ê°œ ì¼ì¹˜! ë³´ë„ˆìŠ¤ ${partialMatchPayout}ë°° íšë“! (+${winAmount})`;
                    resultDisplay.style.color = '#4CAF50'; 
                }

            } else {
                // ì¼ì¹˜ ì—†ìŒ
                message = `ê½!. ë‹¤ì‹œ ë„ì „! (-${betAmount})`;
                resultDisplay.style.color = '#d32f2f'; 
            }
            
            resultDisplay.textContent = message;
        }
        
        // --- 7. ì´ˆê¸° ì‹¤í–‰ ---
        populatePayoutTable(); // í™•ë¥ í‘œ ì±„ìš°ê¸°
        loadBalance(); 
        spinButton.addEventListener('click', spinSlots);
        earnCoinButton.addEventListener('click', earnCoin);
        
    </script>
    </body>
</html>
