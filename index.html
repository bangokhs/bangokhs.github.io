<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í™•ë¥  ê¸°ë°˜ ìŠ¬ë¡¯ë¨¸ì‹ </title>
    <style>
        /* CSS: ìŠ¤íƒ€ì¼ ì •ì˜ */
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #f0ff00; /* ë°°ê²½ìƒ‰ ë³€ê²½ (í° í™”ë©´ ì˜¤ë¥˜ ë°©ì§€ ì‹œë„) */
        }
        .balance-box {
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: bold;
            color: #333;
            padding: 10px 20px;
            border: 2px solid #555;
            border-radius: 5px;
            background-color: #ffe082;
        }
        .slot-container {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
        }
        .reel {
            font-size: 60px; 
            width: 100px;
            height: 100px;
            line-height: 100px;
            text-align: center;
            border: 5px solid #000;
            border-radius: 8px;
            background-color: #fff;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        button {
            padding: 12px 40px;
            font-size: 24px;
            cursor: pointer;
            background-color: #e53935;
            color: white;
            border: none;
            border-radius: 8px;
            transition: background-color 0.3s;
            font-weight: bold;
            letter-spacing: 1px;
        }
        button:hover:not(:disabled) {
            background-color: #c62828;
        }
        button:disabled {
            background-color: #ffcdd2;
            cursor: not-allowed;
        }
        #result {
            margin-top: 25px;
            font-size: 28px;
            font-weight: 900;
            min-height: 30px;
        }
    </style>
</head>
<body>
    <h1>í™•ë¥  ìŠ¬ë¡¯ë¨¸ì‹ </h1>
    
    <div class="balance-box">
        ì”ì•¡: <span id="coinBalanceDisplay">100</span> ì½”ì¸ (ë°°íŒ…: 10 ì½”ì¸)
    </div>

    <div class="slot-container">
        <div class="reel" id="reel1">â“</div>
        <div class="reel" id="reel2">â“</div>
        <div class="reel" id="reel3">â“</div>
    </div>

    <button id="spinButton">SPIN</button>

    <div id="result">SPIN ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”!</div>

    <script>
        // JavaScript: ìŠ¬ë¡¯ë¨¸ì‹  ë¡œì§ (ë²„ê·¸ ìˆ˜ì • ë° ì•ˆì •í™” ë²„ì „)
        
        // --- 1. ì„¤ì • ë° ë³€ìˆ˜ ---
        const probabilities = [
            { symbol: 'ğŸ’', weight: 40 }, 
            { symbol: 'ğŸ‹', weight: 30 },
            { symbol: 'ğŸ””', weight: 20 },
            { symbol: 'â­', weight: 7 }, 
            { symbol: '7ï¸âƒ£', weight: 3 }  
        ];
        
        const payouts = {
            'ğŸ’': 10, 'ğŸ‹': 20, 'ğŸ””': 50, 'â­': 100, '7ï¸âƒ£': 500
        };
        
        const partialMatchPayout = 3; 
        const INITIAL_BALANCE = 100; 
        
        let coinBalance; 
        const betAmount = 10;
        const REEL_STOP_INTERVAL = 1000; 
        const SPIN_DURATION = 3000; 
        const STORAGE_KEY = 'slotMachineCoinBalance'; 

        const reelElements = [
            document.getElementById('reel1'),
            document.getElementById('reel2'),
            document.getElementById('reel3')
        ];
        const spinButton = document.getElementById('spinButton');
        const resultDisplay = document.getElementById('result');
        const balanceDisplay = document.getElementById('coinBalanceDisplay');

        // --- 2. ë¡œì»¬ ì €ì¥ì†Œ ë° ì”ì•¡ ê´€ë¦¬ ---

        function saveBalance() {
            localStorage.setItem(STORAGE_KEY, coinBalance.toString());
        }

        function loadBalance() {
            const savedBalance = localStorage.getItem(STORAGE_KEY);
            if (savedBalance === null || isNaN(parseInt(savedBalance)) || parseInt(savedBalance) < 0) {
                coinBalance = INITIAL_BALANCE;
            } else {
                coinBalance = parseInt(savedBalance);
            }
            updateBalanceDisplay();
        }

        function updateBalanceDisplay() {
            balanceDisplay.textContent = coinBalance;
            saveBalance(); 

            if (coinBalance < betAmount) {
                spinButton.disabled = true;
                resultDisplay.textContent = "ì½”ì¸ ë¶€ì¡±! ë‹¤ì‹œ ì‹œì‘í•˜ë ¤ë©´ ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”.";
                resultDisplay.style.color = 'red';
            } else {
                spinButton.disabled = false;
            }
        }

        // --- 3. í™•ë¥  ê¸°ë°˜ ì‹¬ë³¼ ì„ íƒ ë¡œì§ ---
        
        function getSymbolByProbability() {
            const totalWeight = probabilities.reduce((sum, item) => sum + item.weight, 0);
            let random = Math.random() * totalWeight;

            for (const item of probabilities) {
                if (random < item.weight) {
                    return item.symbol;
                }
                random -= item.weight;
            }
            return probabilities[probabilities.length - 1].symbol; 
        }
        
        // --- 4. ë¦´ íšŒì „ ëª¨ì…˜ ë¡œì§ ---
        
        function startSpinMotion(reelElement, spinDuration) {
            const allSymbols = probabilities.map(p => p.symbol);
            let startTime = null;

            function animate(timestamp) {
                if (!startTime) startTime = timestamp;
                const elapsed = timestamp - startTime;
                
                if (elapsed < spinDuration) {
                    const randomIndex = Math.floor(Math.random() * allSymbols.length);
                    reelElement.textContent = allSymbols[randomIndex];
                    requestAnimationFrame(animate);
                }
            }
            requestAnimationFrame(animate);
        }

        // --- 5. ê²Œì„ ë¡œì§ ---

        function spinReelAndGetResult(reelElement, finalSymbol, spinDuration) {
            return new Promise(resolve => {
                startSpinMotion(reelElement, spinDuration);
                
                setTimeout(() => {
                    reelElement.textContent = finalSymbol;
                    resolve(finalSymbol);
                }, spinDuration);
            });
        }

        async function spinSlots() {
            if (spinButton.disabled) return;

            coinBalance -= betAmount;
            updateBalanceDisplay();
            spinButton.disabled = true;
            resultDisplay.textContent = "ë¦´ì´ ëŒì•„ê°‘ë‹ˆë‹¤... í–‰ìš´ì„ ë¹Œì–´ìš”!";
            resultDisplay.style.color = '#333';
            
            const finalSymbols = reelElements.map(() => getSymbolByProbability()); 
            const spinPromises = [];
            
            for (let i = 0; i < reelElements.length; i++) {
                const duration = SPIN_DURATION + (i * REEL_STOP_INTERVAL);
                
                spinPromises.push(
                    spinReelAndGetResult(reelElements[i], finalSymbols[i], duration)
                );
            }
            
            const results = await Promise.all(spinPromises);

            checkResult(results);
            updateBalanceDisplay();
        }

        function checkResult(results) {
            if (results.length !== 3) {
                resultDisplay.textContent = "ì¹˜ëª…ì ì¸ ì˜¤ë¥˜ ë°œìƒ: ê²°ê³¼ ê°œìˆ˜ ë¶ˆì¼ì¹˜.";
                resultDisplay.style.color = 'red';
                return;
            }

            const [r1, r2, r3] = results;
            let message = "";
            let winAmount = 0;

            if (r1 === r2 && r2 === r3) {
                const multiplier = payouts[r1];
                winAmount = betAmount * multiplier;
                coinBalance += winAmount;
                
                message = `ğŸ‰ ğŸ’¥ğŸ’¥ JACKPOT! ğŸ’¥ğŸ’¥ ${r1} 3ê°œ ì¼ì¹˜! ${multiplier}ë°° íšë“! (+${winAmount})`;
                resultDisplay.style.color = '#ff9800'; 
            } else if (r1 === r2 || r2 === r3 || r1 === r3) {
                winAmount = betAmount * partialMatchPayout;
                coinBalance += winAmount;

                message = `ğŸ¥³ ë‘ ê°œ ì¼ì¹˜! ë³´ë„ˆìŠ¤ ${partialMatchPayout}ë°° íšë“! (+${winAmount})`;
                resultDisplay.style.color = '#4CAF50'; 
            } else {
                message = `ğŸ˜­ ì•„ì‰½ë„¤ìš”. ë‹¤ì‹œ ë„ì „! (-${betAmount})`;
                resultDisplay.style.color = '#d32f2f'; 
            }
            
            resultDisplay.textContent = message;
        }

        // --- 6. ì´ˆê¸° ì‹¤í–‰ ---
        loadBalance(); 
        spinButton.addEventListener('click', spinSlots);
        
    </script>
    </body>
</html>
